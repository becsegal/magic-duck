{"version":3,"file":"package.js","sourceRoot":"","sources":["../ts/package.ts"],"names":[],"mappings":"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","sourcesContent":["import resolvePackagePath from 'resolve-package-path';\nimport { join, dirname } from 'path';\nimport { readFileSync } from 'fs';\nimport { Memoize } from 'typescript-memoize';\nimport type { Configuration } from 'webpack';\nimport {\n  AddonInstance,\n  isDeepAddonInstance,\n  Project,\n  packageName as getPackageName,\n} from '@embroider/shared-internals';\nimport semver from 'semver';\nimport type { TransformOptions } from '@babel/core';\nimport { MacrosConfig } from '@embroider/macros/src/node';\n\n// from child addon instance to their parent package\nconst parentCache: WeakMap<AddonInstance, Package> = new WeakMap();\n\n// from an addon instance or project to its package\nconst packageCache: WeakMap<AddonInstance | Project, Package> = new WeakMap();\n\nlet pkgGeneration = 0;\n\nexport function reloadDevPackages() {\n  pkgGeneration++;\n}\n\nexport interface Options {\n  exclude?: string[];\n  alias?: { [fromName: string]: string };\n  webpack?: Configuration;\n  publicAssetURL?: string;\n  styleLoaderOptions?: Record<string, unknown>;\n  cssLoaderOptions?: Record<string, unknown>;\n  miniCssExtractPluginOptions?: Record<string, unknown>;\n  forbidEval?: boolean;\n  skipBabel?: { package: string; semverRange?: string }[];\n  watchDependencies?: (string | string[])[];\n  insertScriptsAt?: string;\n  insertStylesAt?: string;\n}\n\nexport interface DepResolution {\n  type: 'package';\n  path: string;\n  packageName: string;\n  packageRoot: string;\n}\n\ninterface LocalResolution {\n  type: 'local';\n  local: string;\n}\n\ninterface URLResolution {\n  type: 'url';\n  url: string;\n}\n\ninterface ImpreciseResolution {\n  type: 'imprecise';\n}\n\ntype Resolution =\n  | DepResolution\n  | LocalResolution\n  | URLResolution\n  | ImpreciseResolution;\n\nexport default class Package {\n  public name: string;\n  public root: string;\n  private pkgRoot: string;\n  public isAddon: boolean;\n  private _options: any;\n  private _parent: Project | AddonInstance;\n  private _hasBabelDetails = false;\n  private _babelMajorVersion?: number;\n  private _babelOptions: any;\n  private _emberCLIBabelExtensions?: string[];\n  private autoImportOptions: Options | undefined;\n  private isDeveloping: boolean;\n  private pkgGeneration: number;\n  private pkgCache: any;\n  private macrosConfig: MacrosConfig | undefined;\n\n  static lookupParentOf(child: AddonInstance): Package {\n    if (!parentCache.has(child)) {\n      let pkg = packageCache.get(child.parent);\n      if (!pkg) {\n        pkg = new this(child);\n        packageCache.set(child.parent, pkg);\n      }\n      parentCache.set(child, pkg);\n    }\n    return parentCache.get(child)!;\n  }\n\n  constructor(child: AddonInstance) {\n    this.name = child.parent.pkg.name;\n\n    if (isDeepAddonInstance(child)) {\n      this.root = this.pkgRoot = child.parent.root;\n      this.isAddon = true;\n      this.isDeveloping = this.root === child.project.root;\n      // This is the per-package options from ember-cli\n      this._options = child.parent.options;\n    } else {\n      // this can differ from child.parent.root because Dummy apps are terrible\n      this.root = join(child.project.configPath(), '..', '..');\n      this.pkgRoot = child.parent.root;\n      this.isAddon = false;\n      this.isDeveloping = true;\n      this._options = child.app.options;\n      this.macrosConfig = MacrosConfig.for(child.app, this.root);\n    }\n\n    this._parent = child.parent;\n\n    // Stash our own config options\n    this.autoImportOptions = this._options.autoImport;\n\n    this.pkgCache = child.parent.pkg;\n    this.pkgGeneration = pkgGeneration;\n  }\n\n  _ensureBabelDetails() {\n    if (this._hasBabelDetails) {\n      return;\n    }\n    let { babelOptions, extensions, version } = this.buildBabelOptions(\n      this._parent,\n      this._options\n    );\n    this._emberCLIBabelExtensions = extensions;\n    this._babelOptions = babelOptions;\n    this._babelMajorVersion = version;\n    this._hasBabelDetails = true;\n  }\n\n  get babelOptions(): TransformOptions {\n    this._ensureBabelDetails();\n    return this._babelOptions;\n  }\n\n  get babelMajorVersion() {\n    this._ensureBabelDetails();\n    return this._babelMajorVersion;\n  }\n\n  @Memoize()\n  get isFastBootEnabled() {\n    return (\n      process.env.FASTBOOT_DISABLED !== 'true' &&\n      this._parent.addons.some((addon) => addon.name === 'ember-cli-fastboot')\n    );\n  }\n\n  private buildBabelOptions(instance: Project | AddonInstance, options: any) {\n    // Generate the same babel options that the package (meaning app or addon)\n    // is using. We will use these so we can configure our parser to\n    // match.\n    let babelAddon = instance.addons.find(\n      (addon) => addon.name === 'ember-cli-babel'\n    ) as any;\n    let version = parseInt(babelAddon.pkg.version.split('.')[0], 10);\n    let babelOptions, extensions;\n\n    babelOptions = babelAddon.buildBabelOptions(options);\n    extensions = babelOptions.filterExtensions || ['js'];\n\n    // https://github.com/babel/ember-cli-babel/issues/227\n    delete babelOptions.annotation;\n    delete babelOptions.throwUnlessParallelizable;\n    delete babelOptions.filterExtensions;\n\n    if (babelOptions.plugins) {\n      babelOptions.plugins = babelOptions.plugins.filter(\n        (p: any) => !p._parallelBabel\n      );\n    }\n\n    return { babelOptions, extensions, version };\n  }\n\n  private get pkg() {\n    if (\n      !this.pkgCache ||\n      (this.isDeveloping && pkgGeneration !== this.pkgGeneration)\n    ) {\n      // avoiding `require` here because we don't want to go through the\n      // require cache.\n      this.pkgCache = JSON.parse(\n        readFileSync(join(this.pkgRoot, 'package.json'), 'utf-8')\n      );\n      this.pkgGeneration = pkgGeneration;\n    }\n    return this.pkgCache;\n  }\n\n  get namespace(): string {\n    // This namespacing ensures we can be used by multiple packages as\n    // well as by an addon and its dummy app simultaneously\n    return `${this.name}/${this.isAddon ? 'addon' : 'app'}`;\n  }\n\n  // extra dependencies that must be treated as if they were really dependencies\n  // of this package. sigh.\n  //\n  // maps from packageName to packageRoot\n  magicDeps: Map<string, string> | undefined;\n\n  private hasDependency(name: string): boolean {\n    let { pkg } = this;\n    return Boolean(\n      pkg.dependencies?.[name] ||\n        pkg.devDependencies?.[name] ||\n        pkg.peerDependencies?.[name] ||\n        this.magicDeps?.get(name)\n    );\n  }\n\n  // the semver range of the given package that our package requests in\n  // package.json\n  requestedRange(packageName: string): string | undefined {\n    let { pkg } = this;\n    return (\n      pkg.dependencies?.[packageName] ||\n      pkg.devDependencies?.[packageName] ||\n      pkg.peerDependencies?.[packageName]\n    );\n  }\n\n  private hasNonDevDependency(name: string): boolean {\n    let pkg = this.pkg;\n    return Boolean(\n      pkg.dependencies?.[name] ||\n        pkg.peerDependencies?.[name] ||\n        this.magicDeps?.has(name)\n    );\n  }\n\n  static categorize(importedPath: string, partial = false) {\n    if (/^(\\w+:)?\\/\\//.test(importedPath) || importedPath.startsWith('data:')) {\n      return 'url';\n    }\n\n    if (importedPath[0] === '.' || importedPath[0] === '/') {\n      return 'local';\n    }\n\n    if (partial && !isPrecise(importedPath)) {\n      return 'imprecise';\n    }\n    return 'dep';\n  }\n\n  resolve(\n    importedPath: string,\n    fromPath: string\n  ): DepResolution | LocalResolution | URLResolution | undefined;\n  resolve(\n    importedPath: string,\n    fromPath: string,\n    partial: true\n  ):\n    | DepResolution\n    | LocalResolution\n    | URLResolution\n    | ImpreciseResolution\n    | undefined;\n  resolve(\n    importedPath: string,\n    fromPath: string,\n    partial = false\n  ): Resolution | undefined {\n    switch (Package.categorize(importedPath, partial)) {\n      case 'url':\n        return { type: 'url', url: importedPath };\n      case 'local':\n        return {\n          type: 'local',\n          local: importedPath,\n        };\n      case 'imprecise':\n        if (partial) {\n          return {\n            type: 'imprecise',\n          };\n        }\n        break;\n    }\n\n    let path = this.aliasFor(importedPath);\n    let packageName = getPackageName(path);\n    if (!packageName) {\n      // this can only happen if the user supplied an alias that points at a\n      // relative or absolute path, rather than a package name. If the\n      // originally authored import was an absolute or relative path, it would\n      // have hit our { type: 'local' } condition before we ran aliasFor.\n      //\n      // At the moment, we don't try to handle this case, but we could in the\n      // future.\n      return {\n        type: 'local',\n        local: path,\n      };\n    }\n\n    if (this.excludesDependency(packageName)) {\n      // This package has been explicitly excluded.\n      return;\n    }\n\n    if (!this.hasDependency(packageName)) {\n      return;\n    }\n\n    let packageRoot: string | undefined;\n\n    let packagePath = resolvePackagePath(packageName, this.root);\n    if (packagePath) {\n      packageRoot = dirname(packagePath);\n    }\n\n    if (!packageRoot) {\n      packageRoot = this.magicDeps?.get(packageName);\n    }\n\n    if (packageRoot == null) {\n      throw new Error(\n        `${this.name} tried to import \"${packageName}\" in \"${fromPath}\" but the package was not resolvable from ${this.root}`\n      );\n    }\n\n    if (isV1EmberAddonDependency(packageRoot)) {\n      // ember addon are not auto imported\n      return;\n    }\n    this.assertAllowedDependency(packageName, fromPath);\n    return {\n      type: 'package',\n      path,\n      packageName,\n      packageRoot,\n    };\n  }\n\n  private assertAllowedDependency(name: string, fromPath: string) {\n    if (this.isAddon && !this.hasNonDevDependency(name)) {\n      throw new Error(\n        `${this.name} tried to import \"${name}\" in \"${fromPath}\" from addon code, but \"${name}\" is a devDependency. You may need to move it into dependencies.`\n      );\n    }\n  }\n\n  private excludesDependency(name: string): boolean {\n    return Boolean(\n      this.autoImportOptions &&\n        this.autoImportOptions.exclude &&\n        this.autoImportOptions.exclude.includes(name)\n    );\n  }\n\n  get webpackConfig(): any {\n    return this.autoImportOptions && this.autoImportOptions.webpack;\n  }\n\n  get skipBabel(): Options['skipBabel'] {\n    return this.autoImportOptions && this.autoImportOptions.skipBabel;\n  }\n\n  get aliases(): Record<string, string> | undefined {\n    return this.autoImportOptions?.alias;\n  }\n\n  // this follows the same rules as webpack's resolve.alias. It's a prefix\n  // match, unless the configured pattern ends with \"$\" in which case that means\n  // exact match.\n  private aliasFor(name: string): string {\n    let alias = this.autoImportOptions?.alias;\n    if (!alias) {\n      return name;\n    }\n\n    let exactMatch = alias[`${name}$`];\n    if (exactMatch) {\n      return exactMatch;\n    }\n    let prefixMatch = Object.keys(alias).find((pattern) =>\n      name.startsWith(pattern)\n    );\n    if (prefixMatch && alias[prefixMatch]) {\n      return alias[prefixMatch] + name.slice(prefixMatch.length);\n    }\n    return name;\n  }\n\n  get fileExtensions(): string[] {\n    this._ensureBabelDetails();\n\n    // type safety: this will have been populated by the call above\n    return this._emberCLIBabelExtensions!;\n  }\n\n  publicAssetURL(): string {\n    if (this.isAddon) {\n      throw new Error(`bug: only the app should control publicAssetURL`);\n    }\n    return ensureTrailingSlash(\n      this.autoImportOptions?.publicAssetURL ??\n        ensureTrailingSlash((this._parent as any).config().rootURL) + 'assets/'\n    );\n  }\n\n  get styleLoaderOptions(): Record<string, unknown> | undefined {\n    // only apps (not addons) are allowed to set this\n    return this.isAddon\n      ? undefined\n      : this.autoImportOptions?.styleLoaderOptions;\n  }\n\n  get cssLoaderOptions(): Record<string, unknown> | undefined {\n    // only apps (not addons) are allowed to set this\n    return this.isAddon ? undefined : this.autoImportOptions?.cssLoaderOptions;\n  }\n\n  get miniCssExtractPluginOptions(): Record<string, unknown> | undefined {\n    // only apps (not addons) are allowed to set this\n    return this.isAddon\n      ? undefined\n      : this.autoImportOptions?.miniCssExtractPluginOptions;\n  }\n\n  get forbidsEval(): boolean {\n    // only apps (not addons) are allowed to set this, because it's motivated by\n    // the apps own Content Security Policy.\n    return Boolean(\n      !this.isAddon &&\n        this.autoImportOptions &&\n        this.autoImportOptions.forbidEval\n    );\n  }\n\n  get insertScriptsAt(): string | undefined {\n    if (this.isAddon) {\n      throw new Error(`bug: only apps should control insertScriptsAt`);\n    }\n    return this.autoImportOptions?.insertScriptsAt;\n  }\n\n  get insertStylesAt(): string | undefined {\n    if (this.isAddon) {\n      throw new Error(`bug: only apps should control insertStylesAt`);\n    }\n    return this.autoImportOptions?.insertStylesAt;\n  }\n\n  get watchedDirectories(): string[] | undefined {\n    // only apps (not addons) are allowed to set this\n    if (!this.isAddon && this.autoImportOptions?.watchDependencies) {\n      return this.autoImportOptions.watchDependencies\n        .map((nameOrNames) => {\n          let names: string[];\n          if (typeof nameOrNames === 'string') {\n            names = [nameOrNames];\n          } else {\n            names = nameOrNames;\n          }\n          let cursor = this.root;\n          for (let name of names) {\n            let path = resolvePackagePath(name, cursor);\n            if (!path) {\n              return undefined;\n            }\n            cursor = dirname(path);\n          }\n          return cursor;\n        })\n        .filter(Boolean) as string[];\n    }\n  }\n\n  cleanBabelConfig(): TransformOptions {\n    if (this.isAddon) {\n      throw new Error(`Only the app can generate auto-import's babel config`);\n    }\n    // casts here are safe because we just checked isAddon is false\n    let parent = this._parent as Project;\n    let macrosConfig = this.macrosConfig!;\n\n    let emberSource = parent.addons.find(\n      (addon) => addon.name === 'ember-source'\n    );\n    if (!emberSource) {\n      throw new Error(`failed to find ember-source in addons of ${this.name}`);\n    }\n    let ensureModuleApiPolyfill = semver.satisfies(\n      emberSource.pkg.version,\n      '<3.27.0',\n      { includePrerelease: true }\n    );\n    let templateCompilerPath: string = (emberSource as any).absolutePaths\n      .templateCompiler;\n\n    let plugins = [\n      [require.resolve('@babel/plugin-proposal-decorators'), { legacy: true }],\n      [\n        require.resolve('@babel/plugin-proposal-class-properties'),\n        { loose: false },\n      ],\n      [\n        require.resolve('babel-plugin-htmlbars-inline-precompile'),\n        {\n          ensureModuleApiPolyfill,\n          templateCompilerPath,\n          modules: {\n            'ember-cli-htmlbars': 'hbs',\n            '@ember/template-compilation': {\n              export: 'precompileTemplate',\n              disableTemplateLiteral: true,\n              shouldParseScope: true,\n              isProduction: process.env.EMBER_ENV === 'production',\n            },\n          },\n        },\n      ],\n      ...macrosConfig.babelPluginConfig(),\n    ];\n\n    if (ensureModuleApiPolyfill) {\n      plugins.push([\n        require.resolve('babel-plugin-ember-modules-api-polyfill'),\n      ]);\n    }\n\n    return {\n      // do not use the host project's own `babel.config.js` file. Only a strict\n      // subset of features are allowed in the third-party code we're\n      // transpiling.\n      //\n      // - every package gets babel preset-env unless skipBabel is configured\n      //   for them.\n      // - because we process v2 ember packages, we enable inline hbs (with no\n      //   custom transforms) and modules-api-polyfill\n      configFile: false,\n      babelrc: false,\n\n      // leaving this unset can generate an unhelpful warning from babel on\n      // large files like 'Note: The code generator has deoptimised the\n      // styling of... as it exceeds the max of 500KB.\"\n      generatorOpts: {\n        compact: true,\n      },\n\n      plugins,\n      presets: [\n        [\n          require.resolve('@babel/preset-env'),\n          {\n            modules: false,\n            targets: parent.targets,\n          },\n        ],\n      ],\n    };\n  }\n\n  browserslist() {\n    if (this.isAddon) {\n      throw new Error(`Only the app can determine the browserslist`);\n    }\n    // cast here is safe because we just checked isAddon is false\n    let parent = this._parent as Project;\n    return (parent.targets as { browsers: string[] }).browsers.join(',');\n  }\n}\n\nconst isAddonCache = new Map<string, boolean>();\nfunction isV1EmberAddonDependency(packageRoot: string): boolean {\n  let cached = isAddonCache.get(packageRoot);\n  if (cached === undefined) {\n    // eslint-disable-next-line @typescript-eslint/no-var-requires\n    let packageJSON = require(join(packageRoot, 'package.json'));\n    let answer =\n      packageJSON.keywords?.includes('ember-addon') &&\n      (packageJSON['ember-addon']?.version ?? 1) < 2;\n    isAddonCache.set(packageRoot, answer);\n    return answer;\n  } else {\n    return cached;\n  }\n}\n\nfunction count(str: string, letter: string): number {\n  return [...str].reduce((a, b) => a + (b === letter ? 1 : 0), 0);\n}\n\nfunction isPrecise(leadingQuasi: string): boolean {\n  if (leadingQuasi.startsWith('.') || leadingQuasi.startsWith('/')) {\n    return true;\n  }\n  let slashes = count(leadingQuasi, '/');\n  let minSlashes = leadingQuasi.startsWith('@') ? 2 : 1;\n  return slashes >= minSlashes;\n}\n\nfunction ensureTrailingSlash(url: string): string {\n  if (url[url.length - 1] !== '/') {\n    url = url + '/';\n  }\n  return url;\n}\n"]}